# Документация Test Suite'ов для проекта Stellar Burgers

## Цель работы

В рамках данной работы требуется разработать тестовую документацию для веб-приложения по индивидуальному заданию.

**Цель работы:** разработать test suite с детальными test case для тестирования функциональности приложения Stellar Burgers.

**Необходимо:** проект Stellar Burgers, браузер и редактор кода.

**Задание:** разработать документацию тестирования, включающую минимум 2 test suite с минимум 7 test case в каждом, следуя этапам:
1. Изучение архитектуры и функциональности приложения;
2. Определение ключевых областей для тестирования;
3. Разработка test suite для каждой области;
4. Описание детальных test case с предусловиями, шагами и ожидаемыми результатами;
5. Приоритизация тест-кейсов.

---

## Оглавление
1. [Authentication & User Management Test Suite](#authentication--user-management-test-suite);
2. [Burger Constructor Test Suite](#burger-constructor-test-suite).

---

## Authentication & User Management Test Suite

**Описание:** Набор тестов для проверки функциональности аутентификации, регистрации и управления пользователями в приложении Stellar Burgers.

**Ключевые компоненты:**
- `src/services/slices/userSlice.ts` - Redux слайс для управления состоянием пользователя;
- `src/pages/login/login.tsx` - Страница входа;
- `src/pages/register/register.tsx` - Страница регистрации;
- `src/pages/forgot-password/forgot-password.tsx` - Страница восстановления пароля;
- `src/pages/reset-password/reset-password.tsx` - Страница сброса пароля;
- `src/pages/profile/profile.tsx` - Страница профиля;
- `src/components/protected-route/protected-route.tsx` - Компонент защищенных маршрутов;
- `src/utils/burger-api.ts` - API методы для работы с пользователями.

---

### TC-AUTH-001: Успешная регистрация нового пользователя

**Приоритет:** Высокий  
**Тип теста:** Интеграционный / E2E

**Описание:**  
Проверка успешной регистрации нового пользователя с корректными данными.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь не авторизован;
- Email для регистрации еще не зарегистрирован в системе.

**Шаги выполнения:**
1. Перейти на страницу регистрации `/register`;
2. Ввести имя: "Иван Тестов";
3. Ввести email: "test@example.com";
4. Ввести пароль: "Test123456";
5. Нажать кнопку "Зарегистрироваться".

**Ожидаемый результат:**
- Отправляется POST запрос к API `/auth/register`;
- Redux action `registerUser.fulfilled` выполняется успешно;
- В state сохраняются данные пользователя (`user.user` содержит объект с email и name);
- `accessToken` сохраняется в cookie;
- `refreshToken` сохраняется в localStorage;
- Флаг `isAuthChecked` устанавливается в `true`;
- Происходит редирект на главную страницу `/`.

---

### TC-AUTH-002: Регистрация с уже существующим email

**Приоритет:** Высокий  
**Тип теста:** Интеграционный

**Описание:**  
Проверка обработки ошибки при попытке регистрации с email, который уже зарегистрирован в системе.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь не авторизован;
- Email "existing@example.com" уже зарегистрирован в системе.

**Шаги выполнения:**
1. Перейти на страницу регистрации `/register`;
2. Ввести имя: "Иван Иванов";
3. Ввести email: "existing@example.com";
4. Ввести пароль: "Password123";
5. Нажать кнопку "Зарегистрироваться".

**Ожидаемый результат:**
- Отправляется POST запрос к API `/auth/register`;
- API возвращает ошибку с кодом 403;
- Redux action `registerUser.rejected` срабатывает;
- В `state.user.error` сохраняется текст ошибки;
- Пользователь остается на странице регистрации;
- Отображается сообщение об ошибке "User with such email already exists".

---

### TC-AUTH-003: Успешный вход в систему

**Приоритет:** Критический  
**Тип теста:** Интеграционный / E2E

**Описание:**  
Проверка успешной аутентификации пользователя с корректными учетными данными.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь не авторизован;
- В системе существует пользователь с email "test@example.com" и паролем "Test123456".

**Шаги выполнения:**
1. Перейти на страницу входа `/login`;
2. Ввести email: "test@example.com";
3. Ввести пароль: "Test123456";
4. Нажать кнопку "Войти".

**Ожидаемый результат:**
- Отправляется POST запрос к API `/auth/login`;
- Redux action `loginUser.fulfilled` выполняется успешно;
- В state сохраняются данные пользователя;
- `accessToken` сохраняется в cookie;
- `refreshToken` сохраняется в localStorage;
- Флаг `isAuthChecked` устанавливается в `true`;
- Происходит редирект на страницу, с которой пользователь пришел, или на главную `/`.

---

### TC-AUTH-004: Вход с неверным паролем

**Приоритет:** Высокий  
**Тип теста:** Интеграционный

**Описание:**  
Проверка обработки ошибки при попытке входа с неверным паролем.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь не авторизован;
- В системе существует пользователь с email "test@example.com".

**Шаги выполнения:**
1. Перейти на страницу входа `/login`;
2. Ввести email: "test@example.com";
3. Ввести неверный пароль: "WrongPassword";
4. Нажать кнопку "Войти".

**Ожидаемый результат:**
- Отправляется POST запрос к API `/auth/login`;
- API возвращает ошибку с кодом 401;
- Redux action `loginUser.rejected` срабатывает;
- В `state.user.error` сохраняется текст ошибки;
- Пользователь остается на странице входа;
- Отображается сообщение об ошибке "email or password are incorrect";
- Данные пользователя не сохраняются в state.

---

### TC-AUTH-005: Выход из системы

**Приоритет:** Высокий  
**Тип теста:** Интеграционный

**Описание:**  
Проверка корректного выхода пользователя из системы.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь авторизован;
- В cookie сохранен `accessToken`;
- В localStorage сохранен `refreshToken`.

**Шаги выполнения:**
1. Перейти в профиль пользователя `/profile`;
2. Нажать кнопку "Выход" в меню профиля.

**Ожидаемый результат:**
- Отправляется POST запрос к API `/auth/logout` с `refreshToken` в теле запроса;
- Redux action `logoutUser.fulfilled` выполняется успешно;
- `state.user.user` устанавливается в `null`;
- `accessToken` удаляется из cookie;
- `refreshToken` удаляется из localStorage;
- Происходит редирект на страницу входа `/login`.

---

### TC-AUTH-006: Восстановление пароля (forgot password flow)

**Приоритет:** Средний  
**Тип теста:** Интеграционный

**Описание:**  
Проверка функциональности отправки email для восстановления пароля.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь не авторизован;
- В системе существует пользователь с email "test@example.com".

**Шаги выполнения:**
1. Перейти на страницу входа `/login`;
2. Кликнуть на ссылку "Восстановить пароль";
3. Перейти на страницу `/forgot-password`;
4. Ввести email: "test@example.com";
5. Нажать кнопку "Восстановить".

**Ожидаемый результат:**
- Отправляется POST запрос к API `/password-reset` с email в теле запроса;
- API возвращает успешный ответ;
- Происходит редирект на страницу `/reset-password`;
- В localStorage сохраняется флаг, что email был отправлен;
- На указанный email отправляется письмо с кодом для сброса пароля.

---

### TC-AUTH-007: Сброс пароля с валидным кодом

**Приоритет:** Средний  
**Тип теста:** Интеграционный

**Описание:**  
Проверка успешного сброса пароля с использованием кода из email.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь прошел процесс forgot password;
- Пользователь получил код на email;
- Пользователь находится на странице `/reset-password`.

**Шаги выполнения:**
1. Находясь на странице `/reset-password`;
2. Ввести новый пароль: "NewPassword123";
3. Ввести код из email: "valid-reset-code";
4. Нажать кнопку "Сохранить".

**Ожидаемый результат:**
- Отправляется POST запрос к API `/password-reset/reset` с паролем и кодом;
- API возвращает успешный ответ;
- Происходит редирект на страницу входа `/login`;
- Пользователь может войти в систему с новым паролем;
- Удаляется флаг из localStorage о процессе восстановления пароля.

---

### TC-AUTH-008: Обновление данных профиля пользователя

**Приоритет:** Средний  
**Тип теста:** Интеграционный

**Описание:**  
Проверка возможности обновления имени и email в профиле пользователя.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь авторизован;
- Текущие данные пользователя: name="Иван", email="ivan@example.com".

**Шаги выполнения:**
1. Перейти на страницу профиля `/profile`;
2. Изменить имя на: "Иван Обновленный";
3. Изменить email на: "ivan.new@example.com";
4. Нажать кнопку "Сохранить".

**Ожидаемый результат:**
- Отправляется PATCH запрос к API `/auth/user` с обновленными данными;
- В заголовках передается `accessToken`;
- Redux action `updateUser.fulfilled` выполняется успешно;
- В `state.user.user` обновляются данные пользователя;
- Отображается обновленная информация в профиле;
- Форма становится неактивной (кнопки "Сохранить" и "Отмена" скрываются).

---

### TC-AUTH-009: Защищенные маршруты - доступ для авторизованных пользователей

**Приоритет:** Критический  
**Тип теста:** Интеграционный

**Описание:**  
Проверка, что авторизованный пользователь имеет доступ к защищенным страницам.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь авторизован;
- `state.user.user` содержит данные пользователя;
- `state.user.isAuthChecked` = `true`.

**Шаги выполнения:**
1. Находясь на главной странице `/`;
2. Перейти на страницу профиля `/profile`.

**Ожидаемый результат:**
- Компонент `ProtectedRoute` проверяет состояние авторизации;
- Пользователь успешно попадает на страницу `/profile`;
- Отображается контент страницы профиля;
- Редирект на страницу входа не происходит.

---

### TC-AUTH-010: Защищенные маршруты - редирект неавторизованного пользователя

**Приоритет:** Критический  
**Тип теста:** Интеграционный / E2E

**Описание:**  
Проверка, что неавторизованный пользователь перенаправляется на страницу входа при попытке доступа к защищенным страницам.

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь не авторизован;
- `state.user.user` = `null`;
- `state.user.isAuthChecked` = `true`.

**Шаги выполнения:**
1. Находясь на главной странице `/`;
2. Попытаться перейти на страницу профиля `/profile`.

**Ожидаемый результат:**
- Компонент `ProtectedRoute` проверяет состояние авторизации;
- Определяется, что пользователь не авторизован;
- Происходит автоматический редирект на страницу `/login`;
- В `location.state` сохраняется информация о странице, с которой был редирект (`from: /profile`);
- После успешного входа пользователь возвращается на страницу `/profile`.

---

### TC-AUTH-011: Автоматическое обновление токена при истечении

**Приоритет:** Высокий  
**Тип теста:** Юнит / Интеграционный

**Описание:**  
Проверка механизма автоматического обновления access токена при получении ошибки "jwt expired".

**Предусловия:**
- Приложение запущено и доступно;
- Пользователь авторизован;
- `accessToken` истек (expired);
- `refreshToken` в localStorage валиден.

**Шаги выполнения:**
1. Выполнить любой защищенный API запрос (например, получение данных пользователя);
2. API возвращает ошибку "jwt expired";
3. Функция `fetchWithRefresh` перехватывает ошибку.

**Ожидаемый результат:**
- Автоматически отправляется POST запрос к API `/auth/token` с `refreshToken`;
- API возвращает новую пару токенов;
- Новый `accessToken` сохраняется в cookie;
- Новый `refreshToken` сохраняется в localStorage;
- Исходный запрос повторяется с новым `accessToken`;
- Пользователь получает ожидаемые данные;
- Сессия пользователя не прерывается.

---

## Burger Constructor Test Suite

**Описание:** Набор тестов для проверки функциональности конструктора бургеров, включая добавление, удаление и перемещение ингредиентов, расчет стоимости и создание заказа.

**Ключевые компоненты:**
- `src/services/slices/burgerBuilderSlice.ts` - Redux слайс для управления конструктором;
- `src/services/slices/ingredientsSlice.ts` - Redux слайс для управления списком ингредиентов;
- `src/components/burger-constructor/burger-constructor.tsx` - Компонент конструктора;
- `src/components/burger-ingredients/burger-ingredients.tsx` - Компонент списка ингредиентов;
- `src/utils/burger-api.ts` - API методы для работы с заказами.

---

### TC-CONSTRUCTOR-001: Добавление булки в конструктор

**Приоритет:** Критический  
**Тип теста:** Юнит / Интеграционный

**Описание:**  
Проверка добавления булки в конструктор бургера.

**Предусловия:**
- Приложение запущено на странице конструктора `/`;
- Загружен список ингредиентов;
- Конструктор пуст (`state.burgerBuilder.bun` = `null`).

**Шаги выполнения:**
1. Найти булку в списке ингредиентов (тип `bun`);
2. Перетащить булку в зону конструктора (drag & drop) или кликнуть по булке.

**Ожидаемый результат:**
- Вызывается Redux action `addIngredient` с данными булки;
- В `state.burgerBuilder.bun` сохраняется объект булки с уникальным `id` (nanoid);
- Булка отображается вверху и внизу конструктора;
- Счетчик на карточке булки в списке ингредиентов увеличивается на 2;
- Цена в конструкторе обновляется (цена булки * 2).

---

### TC-CONSTRUCTOR-002: Замена булки на другую

**Приоритет:** Высокий  
**Тип теста:** Юнит / Интеграционный

**Описание:**  
Проверка замены одной булки на другую в конструкторе.

**Предусловия:**
- Приложение запущено на странице конструктора `/`;
- В конструкторе уже есть булка "Краторная булка N-200i" (price: 1255);
- `state.burgerBuilder.bun` содержит данные первой булки.

**Шаги выполнения:**
1. Найти другую булку "Флюоресцентная булка R2-D3" (price: 988);
2. Перетащить новую булку в конструктор.

**Ожидаемый результат:**
- Вызывается Redux action `addIngredient` с данными новой булки;
- Старая булка полностью заменяется новой в `state.burgerBuilder.bun`;
- Счетчик на карточке старой булки обнуляется;
- Счетчик на карточке новой булки устанавливается в 2;
- Новая булка отображается вверху и внизу конструктора;
- Цена пересчитывается с учетом новой булки (988 * 2 = 1976).

---

### TC-CONSTRUCTOR-003: Добавление начинки в конструктор

**Приоритет:** Критический  
**Тип теста:** Юнит / Интеграционный

**Описание:**  
Проверка добавления ингредиентов-начинок в конструктор бургера.

**Предусловия:**
- Приложение запущено на странице конструктора `/`;
- Загружен список ингредиентов;
- `state.burgerBuilder.ingredients` = `[]` (пустой массив).

**Шаги выполнения:**
1. Найти соус "Соус Spicy-X" (price: 90, type: "sauce");
2. Перетащить соус в конструктор;
3. Найти основную начинку "Мясо бессмертных моллюсков Protostomia" (price: 1337, type: "main");
4. Перетащить начинку в конструктор.

**Ожидаемый результат:**
- Вызывается Redux action `addIngredient` для каждого ингредиента;
- Ингредиенты добавляются в массив `state.burgerBuilder.ingredients`;
- Каждый ингредиент получает уникальный `id` (nanoid);
- Ингредиенты отображаются между булками в порядке добавления;
- Счетчики на карточках ингредиентов увеличиваются на 1;
- Цена обновляется с учетом добавленных ингредиентов.

---

### TC-CONSTRUCTOR-004: Удаление ингредиента из конструктора

**Приоритет:** Высокий  
**Тип теста:** Юнит / Интеграционный

**Описание:**  
Проверка удаления ингредиента из конструктора.

**Предусловия:**
- В конструкторе есть булка и несколько ингредиентов;
- `state.burgerBuilder.ingredients` содержит минимум 2 элемента.

**Шаги выполнения:**
1. Выбрать второй ингредиент в списке конструктора;
2. Нажать на иконку удаления (крестик) рядом с ингредиентом.

**Ожидаемый результат:**
- Вызывается Redux action `removeIngredient` с `id` ингредиента;
- Ингредиент удаляется из массива `state.burgerBuilder.ingredients`;
- Ингредиент исчезает из визуального представления конструктора;
- Счетчик на карточке удаленного ингредиента уменьшается на 1;
- Цена пересчитывается без учета удаленного ингредиента;
- Порядок остальных ингредиентов сохраняется.

---

### TC-CONSTRUCTOR-005: Перемещение ингредиентов в конструкторе (drag & drop)

**Приоритет:** Средний  
**Тип теста:** Интеграционный

**Описание:**  
Проверка изменения порядка ингредиентов в конструкторе методом drag & drop.

**Предусловия:**
- В конструкторе есть булка и минимум 3 ингредиента;
- Порядок: [Соус1, Мясо1, Сыр1];
- `state.burgerBuilder.ingredients` содержит 3+ элемента.

**Шаги выполнения:**
1. Захватить первый ингредиент (Соус1) в списке конструктора;
2. Перетащить его на позицию третьего ингредиента (после Сыр1);
3. Отпустить ингредиент.

**Ожидаемый результат:**
- Вызывается Redux action `moveIngredient` с параметрами `{dragIndex: 0, hoverIndex: 2}`;
- В массиве `state.burgerBuilder.ingredients` элемент перемещается с позиции 0 на позицию 2;
- Новый порядок: [Мясо1, Сыр1, Соус1];
- Визуально ингредиенты отображаются в новом порядке;
- Цена не изменяется (перемещение не влияет на сумму).

---

### TC-CONSTRUCTOR-006: Расчет общей стоимости бургера

**Приоритет:** Высокий  
**Тип теста:** Юнит

**Описание:**  
Проверка корректности расчета общей стоимости бургера.

**Предусловия:**
- В конструкторе добавлены:.
  - Булка "Краторная булка N-200i" (price: 1255)
  - Соус "Соус Spicy-X" (price: 90)
  - Основа "Мясо бессмертных моллюсков" (price: 1337)
  - Соус "Соус фирменный Space Sauce" (price: 80)

**Шаги выполнения:**
1. Проверить значение переменной `price` в компоненте `BurgerConstructor`.

**Ожидаемый результат:**
- Цена рассчитывается по формуле: (булка * 2) + сумма всех ингредиентов;
- Расчет: (1255 * 2) + 90 + 1337 + 80 = 2510 + 1507 = 4017;
- В UI отображается корректная сумма: "4017 кредитов";
- При добавлении/удалении ингредиентов цена пересчитывается автоматически.

---

### TC-CONSTRUCTOR-007: Создание заказа с авторизацией

**Приоритет:** Критический  
**Тип теста:** Интеграционный / E2E

**Описание:**  
Проверка успешного создания заказа авторизованным пользователем.

**Предусловия:**
- Пользователь авторизован (`state.user.user` не null);
- В конструкторе есть булка и минимум 1 ингредиент;
- `state.burgerBuilder.orderRequest` = `false`.

**Шаги выполнения:**
1. Нажать кнопку "Оформить заказ" в конструкторе.

**Ожидаемый результат:**
- Вызывается Redux action `orderBurger` с массивом ID ингредиентов;
- Массив формируется как: `[bunId, ingredient1Id, ingredient2Id, ..., bunId]`;
- Отправляется POST запрос к API `/orders` с `accessToken` в заголовках;
- `state.burgerBuilder.orderRequest` устанавливается в `true`;
- Отображается индикатор загрузки на кнопке;
- После успешного ответа API:.
  - `state.burgerBuilder.orderModalData` содержит данные заказа (номер заказа)
  - Открывается модальное окно с деталями заказа
  - Конструктор автоматически очищается (`bun` = null, `ingredients` = [])
  - `state.burgerBuilder.orderRequest` = `false`

---

### TC-CONSTRUCTOR-008: Попытка создания заказа без авторизации

**Приоритет:** Высокий  
**Тип теста:** Интеграционный

**Описание:**  
Проверка редиректа на страницу входа при попытке создать заказ без авторизации.

**Предусловия:**
- Пользователь НЕ авторизован (`state.user.user` = null);
- В конструкторе есть булка и ингредиенты.

**Шаги выполнения:**
1. Нажать кнопку "Оформить заказ" в конструкторе.

**Ожидаемый результат:**
- Проверяется наличие пользователя в `state.user.user`;
- Определяется, что пользователь не авторизован;
- Происходит редирект на страницу `/login`;
- Redux action `orderBurger` НЕ вызывается;
- Запрос к API НЕ отправляется;
- Конструктор сохраняет свое состояние;
- После успешного входа пользователь может вернуться и оформить заказ.

---

### TC-CONSTRUCTOR-009: Валидация перед созданием заказа (отсутствие булки)

**Приоритет:** Средний  
**Тип теста:** Юнит / Интеграционный

**Описание:**  
Проверка невозможности создания заказа без булки.

**Предусловия:**
- Пользователь авторизован;
- В конструкторе есть ингредиенты, но НЕТ булки;
- `state.burgerBuilder.bun` = `null`;
- `state.burgerBuilder.ingredients` содержит элементы.

**Шаги выполнения:**
1. Попытаться нажать кнопку "Оформить заказ".

**Ожидаемый результат:**
- Кнопка "Оформить заказ" неактивна (disabled) или отсутствует;
- При попытке клика ничего не происходит;
- Redux action `orderBurger` НЕ вызывается;
- Запрос к API НЕ отправляется;
- Может отображаться подсказка: "Выберите булки и начинку для создания заказа".

---

### TC-CONSTRUCTOR-010: Закрытие модального окна с деталями заказа

**Приоритет:** Средний  
**Тип теста:** Интеграционный

**Описание:**  
Проверка закрытия модального окна с информацией о созданном заказе.

**Предусловия:**
- Заказ успешно создан;
- Открыто модальное окно с деталями заказа;
- `state.burgerBuilder.orderModalData` содержит данные заказа.

**Шаги выполнения:**
1. Нажать на кнопку закрытия модального окна (крестик).
   ИЛИ
2. Нажать на оверлей (затемненную область вокруг модального окна).
   ИЛИ
3. Нажать клавишу ESC.

**Ожидаемый результат:**
- Вызывается Redux action `closeOrderModal`;
- `state.burgerBuilder.orderModalData` устанавливается в `null`;
- Модальное окно закрывается;
- Пользователь возвращается к конструктору;
- Конструктор остается пустым (был очищен при создании заказа).

---

### TC-CONSTRUCTOR-011: Очистка конструктора вручную

**Приоритет:** Низкий  
**Тип теста:** Юнит

**Описание:**  
Проверка ручной очистки конструктора (если такая функция предусмотрена).

**Предусловия:**
- В конструкторе есть булка и несколько ингредиентов;
- `state.burgerBuilder.bun` не null;
- `state.burgerBuilder.ingredients` содержит элементы.

**Шаги выполнения:**
1. Вызвать action `clearConstructor` (через кнопку или программно).

**Ожидаемый результат:**
- Redux action `clearConstructor` выполняется;
- `state.burgerBuilder.bun` устанавливается в `null`;
- `state.burgerBuilder.ingredients` очищается (пустой массив);
- Все счетчики на карточках ингредиентов обнуляются;
- Цена обнуляется;
- Конструктор визуально пустой;
- Кнопка "Оформить заказ" становится неактивной.

---

## Вывод

В результате проделанной работы были получены навыки по разработке тестовой документации для веб-приложений, от анализа архитектуры и функциональных требований до составления детальных тест-кейсов с описанием предусловий, шагов выполнения и ожидаемых результатов. Была разработана документация тестирования для проекта Stellar Burgers, веб-приложения для конструирования и заказа бургеров, с использованием React и Redux Toolkit. Создано 2 test suite с детальным описанием 22 test case, охватывающих функциональность аутентификации пользователей и работу конструктора бургеров. Подобная документация может использоваться командой разработки для обеспечения качества приложения, планирования автоматизации тестирования и проведения регрессионного тестирования.

---

**Версия документа:** 1.0  
**Дата создания:** 16.10.2025

